{% load static %}
<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Catálogo de productos</title>

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    >

    <!-- <link rel="stylesheet" href="{% static 'css/clientes.css' %}"> -->
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">TIENDA ONLINE</a>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row mb-3">
            <div class="col">
                <h1 class="h3 mb-0">Catálogo de productos</h1>
                <p class="text-muted mb-0">Visualiza los productos disponibles y filtra por categoría o destacados.</p>
            </div>
        </div>

        <form method="get" class="row g-3 mb-4 align-items-end">
            <div class="col-md-4">
                <label for="id_q" class="form-label">Buscar producto</label>
                <input
                    type="text"
                    id="id_q"
                    name="q"
                    class="form-control"
                    placeholder="Nombre o descripción..."
                    value="{{ termino_busqueda }}"
                >
            </div>

            <div class="col-md-4">
                <label for="id_categoria" class="form-label">Categoría</label>
                <select id="id_categoria" name="categoria" class="form-select">
                    <option value="">Todas las categorías</option>
                    {% for categoria in categorias %}
                        <option value="{{ categoria.id }}"
                            {% if categoria_seleccionada|default:'' == categoria.id|stringformat:'s' %}selected{% endif %}>
                            {{ categoria.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2">
                <div class="form-check mt-4 pt-2">
                    <input
                        class="form-check-input"
                        type="checkbox"
                        value="1"
                        id="id_destacados"
                        name="destacados"
                        {% if solo_destacados %}checked{% endif %}
                    >
                    <label class="form-check-label" for="id_destacados">
                        Solo destacados
                    </label>
                </div>
            </div>

            <div class="col-md-2 d-grid">
                <button type="submit" class="btn btn-primary">
                    Aplicar filtros
                </button>
            </div>
        </form>

        {% if productos %}
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
                {% for producto in productos %}
                    <div class="col">
                        <div class="card h-100 shadow-sm position-relative">

                            {% if producto.destacado %}
                                <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2">
                                    Destacado
                                </span>
                            {% endif %}

                            {% if producto.imagen_1 %}
                                <img src="{{ producto.imagen_1.url }}"
                                        class="card-img-top"
                                        alt="{{ producto.nombre }}">
                            {% else %}
                                <div class="card-img-top d-flex align-items-center justify-content-center bg-secondary text-white"
                                        style="height: 180px;">
                                    Sin imagen
                                </div>
                            {% endif %}

                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-1">{{ producto.nombre }}</h5>
                                <p class="text-muted mb-1 small">{{ producto.categoria.nombre }}</p>
                                <p class="fw-semibold mb-2">
                                    $ {{ producto.precio_base }}
                                </p>
                                <p class="card-text small text-muted flex-grow-1">
                                    {{ producto.descripcion|truncatechars:100 }}
                                </p>
                                <a href="{% url 'producto_detalle' producto.id %}" class="btn btn-outline-primary mt-auto">
                                    Ver detalle
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info" role="alert">
                No se encontraron productos.
            </div>
        {% endif %}
    </div>

</body>
</html>
